---
title: "回線周りはかなり満足できるものになっているので"
date: "2021-03-06"
categories: 
  - "mac"
  - "windows"
  - "iphone"
  - "linux"
  - "android"
  - "ipad"
  - "その他機械系"
  - "戯言"
---

どうもこんにちは、大量のデータ転送をするとMacBookProがKernel Task暴走で固まるんですが、同じ作業をM1搭載MacBookAirにさせてみるとなんの問題もなくサクサク進むので原因は何かと考えたんですが、もしかしたら有線LANをつなげていて回線が早いからかも知れない、という部分に突き当たった如月翔也（[@showya\_kiss](http://twitter.com/showya_kiss)）です。  
　今日はここ3ヶ月くらいで通信環境を整備したんですが、回線周りが結構満足できる結果になっているので、というお話を中心に戯言編成でお送りしたいと思います。  

## もともとネット回線は遅かった（ドコモ光200Mコース）

　我が家はもともとネット回線は遅かったんですよね。  
　フレッツISDNの時期に無理をしてBフレッツを引いてそれをそのままドコモ光に転用して使っていたので回線のスペックとしては戸建用光プランでは最遅のプランだと思います。  
　とはいえフレッツISDNから移動してきたので何百倍の速度になっており個人的にはそれほど不満はありませんでしたし、個人で使うには高いスペックなので良かったんですが、流石に開通してから何年もたつと不満も貯まってくるのです。  

## 回線速度とPING値に不満があったので回線をアップグレードする事にした

　私個人的にはそんなに不満はなかったんですが、嫁さんと子供ができて、子供がオンラインゲームをするようになると回線を分けて使う都合上速度が気になるようになりますし、子供が遊ぶオンラインゲームは対戦型のTPSなのでPING値が結構重要なんですが、我が家ではPINGが30〜50MSくらいの反応なのでわりと遅い方で、回線がラグくて負けた・死んだと叫ぶわけです。  
　回線については200Mコースなのは知っていたんですが乗り換えに何万もかかるとやってられないので一応聞くだけ聞くか、と思ってNTTに確認したところ1Gのコースに乗り換えるのは工事費用・手数料込みで2000円だというので、ならアップグレードするか、という話になり早々に申し込んで工事をして貰ったのです。  

## ドコモ光1GコースにしたらPINGは安定したが速度が思ったほどではなかった

　回線速度を増して1Gコースにしたんですが、結果的にはPINGは10〜20MSに収まり改善したんですが、回線速度が思ったより出ないという結果になり、色々試してみたんですが我が家側の問題ではなさそうな感じで、回線の向こう側で遅延を起こしているような感じだったので、どうしようかなと思ったんですが、今使っているプロバイダがOCNなんですが、OCNのIPv6サービスを使うと速度が上がるという話を聞いて試す事にしたのです。  

## 実際IPv6は速度は早くなったんですが回線が安定しなかったので

　OCNのIPv6を使ってみて、実際速度は向上したんですが問題があって、回線が非常に不安定になってしまったのです。  
　1日に1回くらいルータを再起動しないと使えない状態になってしまたt理、接続がバツバツ切れてしまったり、特定のデバイスだけエラーを吐くような状態になってしまったのです。  
　これ、IPv6サービスはルータが無料レンタルなんですが、レンタルされたルータが弱いのが原因だと思っていまして、カタログスペックで16台くらいしか接続できないルータに対して30台くらいからアクセスしてるので処理しきれないんだと思っていまして、もうちょっと良いルータを用意すれば問題が解決するんじゃないかと思ったのです。  

## IPv6対応かつ接続台数の多いAM-AX3000HPに乗り換えてみたんですが

　というわけでOCNのIPv6対応でかつ接続台数が32台のAterm AM-AX3000HPを1万円で購入して家に迎えたんですが、ルータを変えたら安定性がまるで変わってきて、かなり速度が出ますし接続も安定する結果になったのです。  
　同時接続台数だけに絞って考えるとIPv6対応で接続台数が30台以上なのってAM-AX3000HPくらいしか選択肢がなかったので選ぶ余裕なくその製品を買う事になったんですが、結果的には良い買い物ができたという事だと思います。  

## M1搭載MacBookAirを使う中で有線LANアダプタをつないだので有線LANの速度を測ったら

　ルータを変更したら安定性と速度が増したので喜んで使っていたのですが、無線で下りが60Mbpsくらい、上りが80Mbpsくらい出ているので満足して使っていたんですが、この前M1搭載MacBookAirのUSB-Cポートを拡張するのにUSB−Cハブを買ったんですが、USB-Cハブに有線LANポートがついていたので「有線の方が早いよな」と思って有線LANで接続したんですが、1000BASEでカテゴリ5eのケーブルを使って下りで100Mbps、上りでは340Mbps出ていたので回線スペックは十分ある感じなんですよね。  
　無線で通信するとやっぱり下りで60Mbpsくらい、上りで80Mbpsくらいしか出ないので有線の方が断然速度が出るので、これからは設置場所が許す限りは有線LANを優先して使っていこうと思います。  
　1GBの回線で上り340Mbps出ているなら結構出ている感じですし、有線だと無線に比べて接続の安定性がまるで違うので結構満足していてルータを変えた事で無線の速度・安定性もかなり変わったので回線周りは結構満足できる感じに仕上がっていると思うのです。  

## Notionについて

　MacBookProでNotionにデータ転送をしているとKernel Taskが暴走する件ですが、これもしかして回線が細いのが原因じゃないかと思っていて、有線接続のM1搭載MacBookAirの方は同じ作業をしても全くKernel Taskが暴走しないですし動作もサクサクしているので、これCPUのアーキテクトの問題なのか回線の問題なのかMacBookPro固有の問題なのかがわからない感じなんですよね。  
　とりあえず一通りのデータを転送してしまえば後は更新分だけの反映でいいのでそんなに厳しくないと思うんですが、今まさに動画データのメインである艦これのプレイ録画をNotionに送る作業をしていて、MacBookProからだとそもそもの作業がもっさりしてできないのでM1搭載MacBookAirにポータブルSSDでデータを移動してM1搭載MacBookAirからNotionにデータを送っているのですが、M1搭載MacBookAirの場合Kernel Taskも暴走しないですしサクサク作業ができますし、あと有線接続なのでデータの転送速度が爆速で作業自体が非常に快適にできるのでとても良いと思っています。  
　Notion周りについてはM1搭載MacBookAirは完全にMacBookProを凌駕しているのでNotionについては重い作業は全部M1搭載MacBookAirからしようと思います。  
　今度試しにMacBookProに有線LANアダプタを噛ませて同じ作業をして重くならないかで問題の切り分けをしようかと思っているんですがどうなんでしょうね……。  

## まとめ

　というわけで、ここ最近でネットの回線周りを色々変更したんですが、速度が上がって安定性が上がってそれなりに満足できる環境ができたんじゃないかと思っている、というお話でした。  
　回線周りはネット生活の満足度を左右する部分なので良くして行きたいですよね。
