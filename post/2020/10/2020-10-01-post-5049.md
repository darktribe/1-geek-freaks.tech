---
title: "Windows10で古いNASを認識しない場合SMB1.0をオンにすると良いです。"
date: "2020-10-01"
categories: 
  - "windows"
  - "アプリ・ソフト"
  - "ソフト・サービス"
  - "その他機械系"
  - "戯言"
---

どうもこんにちは、IPoE導入により使用ルータが変わったので家の中のネット環境をセットアップし直しする必要があり色々面倒に巻き込まれている如月翔也（[@showya\_kiss](http://twitter.com/showya_kiss)）です。まあ一回設定すればいいので我慢です。  
  
　今日はWindows10で古いNASを認識しない場合、Windows10がSMB1.0をデフォルトではオフにしているのが原因なので設定変更するといいですよ、というお話しを中心に戯言編成でお送りしたいと思います。  

## IPoE導入に伴いルータを変更したのです

　我が家ではもともとドコモ光でOCNを使っており200Mコースだったんですが、この前1Gコースに速度を切り替えました。  
　速度の切り替え工事で速度は相当変わったんですが、そこからIPoE（IPV6）を使うと更に一段回早くなるという話を聞いてIPoEを使う事を決意してルータをレンタルし、変更したルータを使ってネット環境を整える事にしたのです。  
　IPoEは回線認証なのでID・パスワードの設定がいらずルータを差し替えるだけで使えたので作業としては非常に単純だったんですが、Wi-Fiを買える話になるのとリリースされるIPアドレスが変わるのでNAS系の設定が必要で、昨日はその作業をしていました。  

## 使っているNASをWindows10に設定しようとしたところ出来ませんでした

　作業の中で使っているNASの設定を行う段階で、MacOSやiPhoneからはアクセスできるのにWindows10からはアクセスできない状態に陥り、再起動やネットワークの確認をしたんですが原因がわからず難儀する結果になりました。  
　問題の切り分けとしては他OSからはアクセスできる、Windows10からIPアドレス指定（「¥¥192.168.xx.xx」）でアクセスしても問題が解消しないのでWindows10独自の問題だなと見当がついたのでちょっと調べてみたんですが、原因と対策方法が見つかりました。  

## 原因を調べた結果、Windows10ではSMB1.0がデフォルトでオフなのが原因でした

　原因を調べた結果、古いNASだとアクセス方法としてSMB1.0を使っているものがあるんですが、Windows10はデフォルトではSMB1.0はオンになっておらず、SMB1.0以外にアクセス方法がないNASの場合はWindows10側でSMB1.0をオンにしてあげないとアクセスできない、というのが原因でした。  
　今手元にWindows8.1とWindows7がないので実機では確認できないんですが、Windows8.1とWindows7の場合はSMB1.0にデフォルト対応しているのでNASへのアクセスは問題なくできているはずです。  
　とはいえ、オンにしてあげさえすればアクセスできる問題なのでそう深刻なものでもなく、次にNASを買う時はSMB1.0でないのを選べばいいだけの話なので問題ありません。  

## SMB1.0をオンにする方法

　Windows10でSMB1.0をオンにする方法は以下のとおりです。  
・Windows10で「コントロールパネル」を検索、コントロールパネルを開く  
・「プログラムと機能」を開き、項目の中にある「Windowsの機能の有効化または無効化」を開いてウィンドウを開く  
・開いたウィンドウで「SMB1.0/CIFS ファイル共有のサポート」にチェックを入れる  
・設定を行った後パソコンの再起動する  
　これだけでオーケーです。  
　使わないままに1ヶ月くらい経過しているといつの間にか無効化されている事があるらしいので、無効になっていた場合はまた同じ作業をして有効化してあげればオーケーです。  

## SMB1.0をオンにしたNASにアクセスできました

　上記の手順でSMB1.0を有効化した後、IPアドレス指定（「¥¥192.168.xx.xx」で指定）してアクセスしたら問題なくアクセスができ、ファイルのオープン／クローズ・ファイルの削除・ファイルのコピーが問題なく出来たので問題は解決しました。  
　基本的にはIPアドレス指定でアクセスできればNASとしては最低限の仕事ができているのでそれで問題ないので問題ないと思います。  

## Macの調子が悪いんですが

　話は変わりましが最近私のMacBookProの調子が悪く、今まで使っていて重いと思った事がなかったんですが動作がカクカクする事が増えてきて、何事かと思って色々調べたんですが、アクティビティモニタで確認したところKarnel Taskが700〜1000パーセントを超える感じで動いていたのでKarnel Taskの暴走問題かと思って再起動したりSMCのリセットを試したり色々しているんですが根本解決にならない感じです。  
　Karnel Task暴走のきっかけとしては「デュアルディスプレイを使う」「ネットワークに負荷をかける」「BlueStacksを起動する」というのがトリガーになるみたいなんですが、デュアルディスプレイはそんなに負荷をかける動作ではないですしネットワークに負荷がかかるのは当たり前ですしBlueStacksは最近まで問題がなかったアプリなので普通に使っている範囲なのでちょっと困っていてどうしようかと思っています。  
　Karnel Taskは熱管理プログラムの実態だと言うので熱発生が暴走のきっかけになるようなんですが、システムモニタソフトでCPU温度を見ると60度台なのに暴走を起こしたり、CPUの使用度もメモリの使用度もまだまだ余裕なのに暴走したりするのでなにか問題があるんだと思うんですよね。  
　あと体感値なんですがGoogle Chrome起動時にマイクラを起動するとJavaが暴走してMacが固まる動作も確認できていて、Javaが暴走しない限りは動作はカクカクにならないのでJavaとChromeの相性問題だなと思っていて、これも何か問題があるのだと思います。  
　最悪OSの再インストールで開所する問題ならばOSの再インストールを行ってもいいんですがそれで問題が解決しないと無駄な時間を使う事になるので、まあ色々試してみて結果としてそれしか無ければOSの再インストールを試してみようと思います。  
　使っているアプリ類がマニアックなので組み合わせが悪くて問題が起こっているのだとしたら世界中で私だけに問題が発生している可能性が考えられるので、とりあえずOSの再インストールをしたらアプリ1個毎に動きを確認しながらインストールしていく感じで試して行きたいと思います。  

## まとめ

　という訳で、家の中のルータを変更し、変更したルータで宅内環境を整えていたらWindows10からNASへアクセスできない事が発覚した、というお話しと、Windows10で古い一部のNASにアクセスできないのはWindows10がデフォルトでSMB1.0を有効化していないのが原因であるという事、Windows10でSMB1.0を有効化するにはコントロールパネルからの作業で有効家ができて再起動が必要だ、というお話しと、最近Macの調子が悪いので最悪MacOSの再インストールを覚悟しているよ、というお話しでした。  
　宅内環境の切り替えは一定のリスクがありますし、こういう目に見えない問題が発覚する事もあるので、余裕のある時に切り替え作業をしたいですよね。
